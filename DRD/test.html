<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8" />

    <link href="../"Re/bootstrap.css" rel="stylesheet">
    <link href="../Re/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../Re/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
<style>
 .uneditable-input,input{
width:150px;
}
body{
margin: 20px;
}

.container{
width: 100%;

}

table.paleBlueRows {
  font-family: "Times New Roman", Times, serif;
  border: 1px solid #FFFFFF;
  width: 98%;
  height: 200px;
  text-align: center;
  border-collapse: collapse;
}
table.paleBlueRows td, table.paleBlueRows th {
  border: 1px solid #FFFFFF;
  padding: 3px 2px;
}
table.paleBlueRows tbody td {
  font-size: 17px;
}
table.paleBlueRows tr:nth-child(even) {
  background: #D0E4F5;
}
table.paleBlueRows thead {
  background: #0B6FA4;
  border-bottom: 5px solid #FFFFFF;
}
table.paleBlueRows thead th {
  font-size: 23px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #FFFFFF;
}
table.paleBlueRows thead th:first-child {
  border-left: none;
}

table.paleBlueRows tfoot {
  font-size: 14px;
  font-weight: bold;
  color: #333333;
  background: #D0E4F5;
  border-top: 3px solid #444444;
}
table.paleBlueRows tfoot td {
  font-size: 14px;
}

.group {
  width: 100%;
  text-align: left;
}
.radio-group {
  width: 100px;
  display: inline-block;
  margin-bottom: 10px;
}
.radio-input {
  visibility: hidden; /* 把原本的input藏起來 */
}
.radio-label {
  font-size: 10px;
  cursor: pointer;
  position: relative;
  padding-left: 1.5rem;
}
.radio-button {
  /* 自定義樣式的span */

height: 0.5rem;
  width: 0.5rem;
 border: 4px solid green;
  border-radius: 50%;
  display: inline-block;
  position: absolute;
  left: 0;
  top: 0;
}
.radio-button::after { /* 中間點點 */
  content: "";
  display: block;
  height: 5px;
  width: 5px;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: green;
  opacity: 0;
  transition: opacity 0.2s;
}
.radio-input:checked ~ .radio-label .radio-button::after {
  /* 選中radio時 才顯示中間點點 */
  opacity: 1;
}



</style>

</head>

<body>

<div class="container" position: relative; ">
<h2>分廳廳主單量查詢</h2>

<div class="group" align="center">
  <div class="radio-group">
    <input type="radio" class="radio-input" id="1" name="number" value="history" checked="true" >
    <label for="1" class="radio-label">
     <span class="radio-button"></span>
     歷史查詢
    </label>
  </div>
  <div class="radio-group">
    <input type="radio" class="radio-input" id="2" name="number" value="now">
    <label for="2" class="radio-label">
      <span class="radio-button"></span>
      即時查詢
    </label>
  </div>

</div>
    <form action="" class="form-horizontal">



            <div class="control-group" style="margin-top:20px;">

<div style="display:inline;padding-right:20px;">
廳主
<script>

          let hall = ["sands澳門金沙娛樂場 [dkk]","GPK [gpk]", "Esball [esb]","銀河娛樂 GALAXY RECREATION [63]",  "A8娛樂城 [a8]", "BBIN [bbin]", "BBOS [bo]", "BS Casino [bs8]", "BWT casino [bwt]", "Bebet casino [beb]", "Bet365 [chn]","公海赌船 [710]", "CG Casino [cgs]", "CRO WN澳門皇冠賭場 [crc]", "EG [em]", "輝煌國際 [hh]", "澳門sands金沙娛樂場 [55]", "澳門金沙集團Macao Sands Group [56]", "GALAXY澳門銀河娛樂場 [63]", "必贏國際 [437]", "銀河娛樂場GALAXY [ga]", "澳門金沙sands娛樂場 [scc]", "THE PARISIAN澳門巴黎人 [940]"];
                    document.write("<select id='num1'>");

                    for (let select of hall) {
                    document.write("<option>");
                    document.write(select);
                    document.write("</option>");
                    }
            document.write("</select>");

 </script>
</div>

                <div style="display:inline; margin-right:30px" class="hide_section">開始時間

                <div class="input-append date form_datetime"  data-link-field="dtp_input1">
                    <input id="picker_start" size="12" type="text" value="" readonly>
                    <span class="add-on"><i class="icon-remove"></i></span>
                    <span class="add-on"><i class="icon-th"></i></span>
                </div>
            </div>

            <div align="right" style="display:inline;" class="hide_section">結束時間
                <div class="input-append date form_datetime"  data-link-field="dtp_input1">
                    <input id="picker_end" size="12" type="text" value="" readonly>
                    <span class="add-on"><i class="icon-remove"></i></span>
                                        <span class="add-on"><i class="icon-th"></i></span>
                </div>
                </div>







<input type="button" id="btn_search"  value="查詢" class="btn btn-default">

  <div class="btn-group" data-toggle="buttons" style="float:right;display:inline; padding-right:100px;">
         </div>



</div>

    </form>

</div>

<a style="position:absolute; top:20px; right:20px; " id="exportBtn" class="btn btn-success" target="_blank" download="單量監控.csv">匯出csv</a>

<div id="jojo"></div>
<div id="member_list" class="table-responsive">

<table class="paleBlueRows">
             <thead>
                <tr>
                  <th scope="col" width="5%"></th>
                  <th scope="col" width="15%">時間</th>
                  <th scope="col" width="15%"><font color="#00c4c4">單量</font></th>
                  <th scope="col" width="15%"><font color="#febf05">昨日同時段單量</font></th>
                  <th scope="col" width="15%"><font color="#ff6275">上週同時段單量</font></th>
                  <th scope="col" width="15%"><font color="#b176c4">上月同時段單量</font></th>
		</tr>
              </thead>


<tbody class="qwe">
      </tbody>

      </table>

</div>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<!--
<script src="../Re/jquery-1.8.2.min.js"></script>
-->
<script src="../Re/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.jquery.min.js"></script>

<script type="text/javascript">
var str;
var str2;
var day;
var today;
var yesterday;
var lastweek;
var month;
var n_val=$("#Select1").val();

$(".paleBlueRows").hide();
$("#Select1").on('change', function() {
n_val=this.value;
//var input = $( "input:radio" )[0];
//var input1 = $( "input:radio" )[1];
//var input2 = $( "input:radio" )[2];
//if(input.checked==true){}


//console.log(input.checked);
//console.log(input1.checked);
//console.log(input2.checked);
//console.log(day);
});
;(function($){
        $.fn.datetimepicker.dates['en'] = {
        days: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"],
          daysShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六", "周日"],
                daysMin:  ["日", "一", "二", "三", "四", "五", "六", "日"],
                months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
                monthsShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
                today: "今天",
    suffix: [],
                meridiem: ["上午", "下午"]
        };
}(jQuery));

    $('.form_datetime').datetimepicker({
        format: "yyyy-mm-dd hh:"+"00:00",
        autoclose: true,
        todayBtn: true,

        startDate: '-3m',
        minView: "day",
        language:"zh-tw"
    });

function date_transform(d) {
      var date = new Date(d);
      Y = date.getFullYear() + '-';
      M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
      D = (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) + '  ';
      h = date.getHours() + ':';
      m = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes());
      //if(m<10){
      //m='0'+m;
      //}
      //if(D<10){
      //D='0'+D;
      //}
      //return 'Y+M+D+h+m'
   }


function trand(d) {
      var date = new Date(d);
      Y = date.getFullYear() + '-';
      M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
      D = (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) + ' ';
      h = date.getHours() + ':';
      m = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes());

      //if(m<10){
      //m='0'+m;
      //}
      //if(D<10){
      //D='0'+D;
      //}
      return Y+M+D+h+m+":00"
   }


function date_ajax(start,end,equl,hall){
var str_time_gap;

str_time_gap="Hall_history_date.php?hall="+hall+"&kind=4&start="+start+"&end="+end;

$.ajax({
            method: "GET",
            url: str_time_gap,
            async: false
        }).done(function(msg) {
console.log(JSON.parse(msg));
if(JSON.parse(msg)==null)
{
alert("查無資料");
}else
{
            var ms = JSON.parse(msg);

//if(ms){

  today = ms.results.data.today;
  yesterday = ms.results.data.yesterday;
  lastweek = ms.results.data.lastweek;
  month= ms.results.data.month;
history(today,yesterday,lastweek,month,equl);
            $(".qwe").empty();

            var thousandComma = function(number) {
           //    console.log(number);
		if(number==null){
		  number=0;
		return number;
		}
		var num = number.toString();
               var pattern = /(-?\d+)(\d{3})/;

               while (pattern.test(num)) {
                  num = num.replace(pattern, "$1,$2");

               }
               return num;

            }

         //   var percent = -(Bet_number[0][2] * 0.12);
console.log(month.length);
console.log(today);
console.log(yesterday);
console.log(lastweek);
console.log(month);
            for (var j = 0; j < today.length ; j++) {

               date_transform(today[j][0]);
		$(".qwe").append('<tr><th scope="row">' + (j + 1) + '</th><td>' + Y + M + D + h + m + '</td><td>' + thousandComma(today[j][1]) +
                  '</td><td>' + thousandComma(yesterday[j][1]) + '</td><td class="jonas">' + thousandComma(lastweek[j][1]) + '</td><td>'+ thousandComma(month[j][1])+'</td>');

            }
            //console.log(htmlobj_yesterday);

     //   var divss = document.getElementsByTagName("tr");

           // for (var i = 1; i < Bet_number.length; i++) {
           //    var objss = divss[i];
           //    if ((Bet_number[i - 1][1] - Bet_number[i][1]) < -10000 && (Bet_number[i - 1][1] - Bet_number[i][1]) > (-(Bet_number[i][1] * 0.12))) {
           //       objss.style.background = "#FF8888";
           //    } else if ((Bet_number[i - 1][1] - Bet_number[i][1]) < (-(Bet_number[i][1] * 0.12))) {
           //       objss.style.background = "#CC0000";
           //    } else {
           //       objss.style.background = "rgba(255,255,255,0.1)";
           //    }
           // }

	  }  //查無資料
	})


}



    $(document).ready(function(){

    $("#btn_search").click(function(){
        var input = $( "input:radio" )[0];
        var input1 = $( "input:radio" )[1];
        if(input.checked==true){

        if($("#picker_start").val()==""){
            alert("你尚未填寫初始日期");
//            eval("document.form1['picker_start'].focus()");
        }else if($("#picker_end").val()==""){
            alert("你尚未填寫結束日期");
//            eval("document.form1['picker_end'].focus()");
        }else if($("#picker_end").val() == $("#picker_start").val()){
        alert("輸入錯誤");
        }else{

var ssss=(new Date($("#picker_start").val())).getTime();
var eeee=(new Date($("#picker_end").val())).getTime();
var equl=(eeee-ssss)/60000;

    $("#jojo").empty();

	date_ajax($("#picker_start").val(),$("#picker_end").val(),equl,$("#num1").val());
	$(".paleBlueRows").show();

    }
}else if(input1.checked==true){
        var today=new Date();
        var min0=today.getTime();
        var min60=today.getTime()-3600000;
        console.log(trand(today));
        console.log(trand(min60));
	$("#jojo").empty();
	date_ajax(trand(min60),trand(today),59,$("#num1").val());
        $(".paleBlueRows").show();
    }
    });
});

//console.log(Bet_number.length);


function history(td,yd,lw,mt,equl) {
console.log(equl);
       $(document).ready(function() {
           var chart = {

                backgroundColor: 'rgba(255,255,255,0.1)'
            }

            var title = {
                text: '日期區間查詢'
            };
            var xAxis = {
                type: 'datetime',

                tickInterval: 600000, //一個區間十分鐘
      		tickWidth: 0,
            gridLineWidth: 1,
            maxZoom: 300,
		crosshair:true
      };
            var yAxis = {
                title: {
                    text: '歷史單量'
                },

                gridLineWidth: 1.5,
                gridLineColor: '#D0E4F5',
                plotLines: [{
                    value: 5.5,
                    width: 1,

                dashStyle: 'longdashdot',
                    color: '#808080'
                }]
            };
            var tooltip = {
                //formatter: function() {
                //    return '<b>' + this.series.name + '</b><br/>' +
                //        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                //        Highcharts.numberFormat(this.y, 2);
                //}
		formatter: function () {
            return this.points.reduce(function (s,point) {
                return s + '<br/>' + point.series.name + ': ' +
                    point.y + '筆';
            }, '<b>' + Highcharts.dateFormat('%Y-%m-%d %H:%M:%S',this.x) + '</b>');
        },
        shared: true

            };
            var plotOptions = {
                area: {
                    pointStart: 1940,
                    marker: {
                        enabled: true,
                        symbol: 'circle',
                        radius: 2,
                        states: {
                            hover: {
                                enabled: true
                            }
                        }
                    }
                }
            };
            var legend = {
                enabled: true
            };
            var exporting = {
                enabled: true
            };
            var series = [{
                name: '單量',
                color: "#00c4c4",
                data: (function() {

                    var data = [],
                        time = (new Date()).getTime(),
                        i;
                    for (i = -1*equl; i <= 0; i += 1) {
                        var y = i + equl;
                        var ddd = new Date(td[y][0]);
                        var time1 = ddd.getTime() ;

                        data.push({
                            x: time1, //整個區段有60個點也就是60分鐘
                            y: (td[y][1] != null ? parseInt(td[y][1]) : 0)
                        });
                    }
                    return data;
                }())
            },{
		name: '昨日同時段單量',
                color: "#febf05",
                data: (function() {

                    var data = [],
                        time = (new Date()).getTime(),
                        i;
                    for (i = -1*equl; i <= 0; i += 1) {
                        var y = i + equl;
                        var ddd = new Date(td[y][0]);
                        var time1 = ddd.getTime() ;

                        data.push({
                            x: time1, //整個區段有60個點也就是60分鐘
                            y: (yd[y][1] != null ? parseInt(yd[y][1]) : 0)
                        });
                    }
                    return data;
                }())
            },{
		name: '上週同時段單量',
                color: "#ff6275",
                data: (function() {

                    var data = [],
                        time = (new Date()).getTime(),
                        i;
                    for (i = -1*equl; i <= 0; i += 1) {
                        var y = i + equl;
                        var ddd = new Date(td[y][0]);
                        var time1 = ddd.getTime() ;

                        data.push({
                            x: time1, //整個區段有60個點也就是60分鐘
                            y: (lw[y][1] != null ? parseInt(lw[y][1]) : 0)
                        });
                    }
                    return data;
                }())

	    },{
                name: '上月同時段單量',
                color: "#b176c4",
                data: (function() {

                    var data = [],
                        time = (new Date()).getTime(),
                        i;
                    for (i = (-1*equl); i <= 0; i += 1) {
                        var y = i + equl;
                        var ddd = new Date(td[y][0]);
                        var time1 = ddd.getTime() ;

                        data.push({
                            x: time1, //整個區段有60個點也就是60分鐘
                            y: (mt[y][1] != null ? parseInt(mt[y][1]) : 0)
                        });
                    }
                    return data;
                }())

            }];

            var json = {};
            json.chart = chart;
            json.title = title;
            json.tooltip = tooltip;
            json.xAxis = xAxis;
            json.yAxis = yAxis;
            json.legend = legend;
            json.exporting = exporting;
            json.series = series;
            json.plotOptions = plotOptions;

            Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });
            $('#jojo').highcharts(json);

        });


    }



$("#exportBtn").click(function() {
        var csvList = [],
        titleList = [],
        memberContent = "",
        csvContent;


        $("#member_list th").each(function() {
        titleList.push(this.innerText);
        // titleList.splice();

        });
        titleList.splice(5,today.length);
        titleList.splice(0,1);
        csvList.push(titleList);

        // 取得所有資料
        $("#member_list tbody > tr").each(function() {
        var regList = [];

        $(this).children("td").each(function() {
           var str=this.innerText;
            str = str.replace(/,/,"，");
        regList.push(str);
        });

        csvList.push(regList);
        });

        // 產生 csv 內容
        csvList.forEach(function(rowArray) {
        var row = rowArray.join(",");
        memberContent += row + "\r\n";
        });

        // 產生 csv Blob
        csvContent = URL.createObjectURL(new Blob(["\uFEFF" + memberContent], {
        type: 'text/csv;charset=utf-8;'
        }));

        // 產生 csv 連結
        this.href = csvContent;
        });

$(document).ready(function(){
$("#num1").chosen();

$('input[type="radio"]').click(function(){
            if($(this).attr("value")=="now"){
                $(".hide_section").hide();

            }
            if($(this).attr("value")=="history"){
                $(".hide_section").show();

            }

        });



});


</script>


</body>
</html>